<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scan Food | MacroMunch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
        }
        .card {
            backdrop-filter: blur(10px);
            background-color: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Back button -->
        <div class="mb-6">
            <a href="index.html" class="flex items-center text-primary hover:text-primary-600 transition">
                <i data-feather="chevron-left" class="mr-1"></i>
                <span>Back to Home</span>
            </a>
        </div>

        <!-- Scan Food Card -->
        <div class="card rounded-2xl p-6 shadow-lg max-w-2xl mx-auto">
            <h1 class="text-2xl font-bold mb-6">Scan Food</h1>
            
            <!-- Upload Section -->
            <div class="mb-8">
                <h2 class="font-medium mb-3">Upload Food Image</h2>
                <div id="upload-area" class="border-2 border-dashed border-gray-700 rounded-xl p-8 text-center cursor-pointer hover:border-primary transition">
                    <div id="upload-content" class="flex flex-col items-center">
                        <i data-feather="upload" class="w-10 h-10 mb-3 text-gray-500"></i>
                        <h3 class="font-medium mb-1">Click to upload or drag and drop</h3>
                        <p class="text-sm text-gray-400">JPG, PNG up to 5MB</p>
                    </div>
                    <input type="file" id="food-image" class="hidden" accept="image/*">
                </div>
            </div>

            <!-- Loading State (hidden by default) -->
            <div id="loading-state" class="hidden mb-8">
                <div class="flex flex-col items-center justify-center py-8">
                    <div class="spinner mb-4">
                        <i data-feather="loader" class="w-12 h-12 text-primary"></i>
                    </div>
                    <p class="text-gray-400">Analyzing your food...</p>
                </div>
            </div>

            <!-- Image Preview (hidden by default) -->
            <div id="image-preview" class="hidden mb-6">
                <h3 class="font-medium mb-2">Uploaded Image</h3>
                <div class="w-full h-48 rounded-xl bg-gray-800 overflow-hidden">
                    <img id="preview-image" class="w-full h-full object-cover" src="">
                </div>
            </div>

            <!-- Scan Results (hidden by default) -->
            <div id="scan-results" class="hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i data-feather="check-circle" class="text-green-500 mr-2"></i>
                    <span>Macros Detected!</span>
                </h2>

                <div class="space-y-6">
                    <div>
                        <label for="scanned-name" class="block text-sm font-medium mb-1">Food Name</label>
                        <input type="text" id="scanned-name" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary">
                    </div>

                    <div>
                        <label for="scanned-serving" class="block text-sm font-medium mb-1">Serving Size</label>
                        <div class="flex items-center">
                            <input type="number" id="scanned-serving" class="w-24 bg-gray-800 border border-gray-700 rounded-l-lg px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary">
                            <select id="scanned-unit" class="bg-gray-700 border-t border-b border-r border-gray-700 rounded-r-lg px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary">
                                <option>g</option>
                                <option>ml</option>
                                <option>oz</option>
                                <option>cup</option>
                                <option>tbsp</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="scanned-calories" class="block text-sm font-medium mb-1">Calories</label>
                            <input type="number" id="scanned-calories" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary">
                        </div>
                        <div>
                            <label for="scanned-protein" class="block text-sm font-medium mb-1">Protein (g)</label>
                            <input type="number" id="scanned-protein" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary">
                        </div>
                        <div>
                            <label for="scanned-carbs" class="block text-sm font-medium mb-1">Carbs (g)</label>
                            <input type="number" id="scanned-carbs" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary">
                        </div>
                        <div>
                            <label for="scanned-fat" class="block text-sm font-medium mb-1">Fat (g)</label>
                            <input type="number" id="scanned-fat" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary">
                        </div>
                    </div>

                    <div class="flex space-x-3 pt-4">
                        <button id="save-btn" class="flex-1 py-3 bg-primary hover:bg-primary-600 rounded-lg font-medium transition">
                            Save to Today's Log
                        </button>
                        <button id="rescan-btn" class="flex-1 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium transition">
                            Try Another Scan
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        feather.replace();
        
        // Mock API response
        const mockApiResponse = {
            foodName: "Grilled Chicken Breast",
            servingSize: 100,
            servingUnit: "g",
            calories: 165,
            protein: 31,
            carbs: 0,
            fat: 3.6
        };

        // DOM Elements
        const uploadArea = document.getElementById('upload-area');
        const uploadContent = document.getElementById('upload-content');
        const foodImageInput = document.getElementById('food-image');
        const loadingState = document.getElementById('loading-state');
        const imagePreview = document.getElementById('image-preview');
        const previewImage = document.getElementById('preview-image');
        const scanResults = document.getElementById('scan-results');
        const saveBtn = document.getElementById('save-btn');
        const rescanBtn = document.getElementById('rescan-btn');

        // Event Listeners
        foodImageInput.addEventListener('change', handleImageUpload);
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('drop', handleDrop);
        saveBtn.addEventListener('click', saveFood);
        rescanBtn.addEventListener('click', resetForm);

        // Functions
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (file) {
                processImage(file);
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('border-primary');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('border-primary');
            
            const file = e.dataTransfer.files[0];
            if (file && file.type.match('image.*')) {
                processImage(file);
            }
        }

        function processImage(file) {
            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImage.src = e.target.result;
                uploadContent.classList.add('hidden');
                imagePreview.classList.remove('hidden');
                
                // Show loading state
                loadingState.classList.remove('hidden');
                
                // Simulate API call with timeout
                setTimeout(() => {
                    loadingState.classList.add('hidden');
                    fillFormWithMockData();
                    scanResults.classList.remove('hidden');
                }, 2000);
            };
            reader.readAsDataURL(file);
        }

        function fillFormWithMockData() {
            document.getElementById('scanned-name').value = mockApiResponse.foodName;
            document.getElementById('scanned-serving').value = mockApiResponse.servingSize;
            document.getElementById('scanned-unit').value = mockApiResponse.servingUnit;
            document.getElementById('scanned-calories').value = mockApiResponse.calories;
            document.getElementById('scanned-protein').value = mockApiResponse.protein;
            document.getElementById('scanned-carbs').value = mockApiResponse.carbs;
            document.getElementById('scanned-fat').value = mockApiResponse.fat;
        }

        function saveFood() {
            // In a real app, this would save to local storage/DB
            alert('Food saved to your log!');
            window.location.href = 'index.html';
        }

        function resetForm() {
            foodImageInput.value = '';
            uploadContent.classList.remove('hidden');
            imagePreview.classList.add('hidden');
            scanResults.classList.add('hidden');
            loadingState.classList.add('hidden');
        }
    </script>
</body>
</html>